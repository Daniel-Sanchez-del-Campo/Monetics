<h2 mat-dialog-title class="dialog-title">
  <mat-icon class="title-icon">history</mat-icon>
  Historial del Gasto
</h2>

<mat-dialog-content>
  <p class="gasto-desc">{{ data.descripcion }}</p>

  @if (loading) {
    <div class="loading-container">
      <mat-spinner diameter="40"></mat-spinner>
    </div>
  } @else if (historial.length === 0) {
    <div class="empty-historial">
      <mat-icon>info</mat-icon>
      <p>No hay cambios de estado registrados</p>
    </div>
  } @else {
    <div class="timeline">
      @for (item of historial; track item.idAuditoria; let last = $last) {
        <div class="timeline-item">
          <div class="timeline-dot-col">
            <div class="timeline-dot" [ngClass]="getEstadoClass(item.estadoNuevo)">
              <mat-icon>{{ getEstadoIcon(item.estadoNuevo) }}</mat-icon>
            </div>
            @if (!last) {
              <div class="timeline-line"></div>
            }
          </div>
          <div class="timeline-content">
            <div class="timeline-header">
              <span class="timeline-estado" [ngClass]="getEstadoClass(item.estadoNuevo)">
                {{ item.estadoNuevo }}
              </span>
              <span class="timeline-fecha">{{ item.fechaCambio | date:'dd/MM/yyyy HH:mm' }}</span>
            </div>
            <div class="timeline-user">
              <mat-icon>person</mat-icon>
              {{ item.nombreUsuarioAccion }}
            </div>
            @if (item.comentario) {
              <div class="timeline-comment">
                <mat-icon>comment</mat-icon>
                {{ item.comentario }}
              </div>
            }
          </div>
        </div>
      }
    </div>
  }
</mat-dialog-content>

<mat-dialog-actions align="end">
  <button mat-button (click)="cerrar()" class="btn-cancel">Cerrar</button>
</mat-dialog-actions>
